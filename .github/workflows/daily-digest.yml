name: Daily Digest

on:
  schedule:
    - cron: '0 13 * * *' # Runs daily at 13:00 UTC
  workflow_dispatch:

jobs:
  digest:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '22'
      - name: Install dependencies
        run: npm install
      - name: Run digest bot
        env:
          DISCORD_TOKEN: ${{ secrets.DISCORD_TOKEN }}
          DISCORD_CHANNELS: ${{ secrets.DISCORD_CHANNELS }}
          SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
          SLACK_CHANNEL_ID: ${{ secrets.SLACK_CHANNEL_ID }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          GEMINI_MODEL: ${{ secrets.GEMINI_MODEL }}
          MAX_SUMMARY_TOKENS: ${{ secrets.MAX_SUMMARY_TOKENS }}
          DRY_RUN: false
          DIGEST_WINDOW_HOURS: 24
          LOG_LEVEL: info
          MIN_MESSAGE_LENGTH: 20
          EXCLUDE_COMMANDS: true
          EXCLUDE_LINK_ONLY: true
        run: npm start
